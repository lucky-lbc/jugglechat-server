import{r as C,ad as D,n as b,z as k,c as f,b as r,F as A,e as T,u as c,l as V,w as E,p as R,H as N,o as g,x as P,t as h,ae as F,f as i,i as S}from"./index-611f2efb.js";import{c as y}from"./common-bf7d9f43.js";import{A as B}from"./analysis-069f95a2.js";const I={class:"mb-4 cim-as-box"},M={class:"cim-as-tools"},O={class:"cim-as-tool"},U=["onClick"],$={class:"cim-as-date cicon cicon-date"},q=["onClick"],z={class:"row cim-as-body"},G={class:"cim-bk-form",ref:"asuserchat"},j={__name:"user",setup(W){const m=S();let w=R(),{currentRoute:{_rawValue:{params:{app_key:u}}}}=w,n=C({buttons:D,range:{start:new Date(Date.now()-8*24*60*60*1e3),end:new Date(Date.now()-1*24*60*60*1e3)}}),d=null;function p(e){if(!d){let{asuserchat:o}=m.refs;d=m.proxy.$echat.init(o)}let{daus:a,dates:s}=y.formatDauChat(e),l={legend:{data:["日活"]},tooltip:{trigger:"none",axisPointer:{type:"cross"}},xAxis:{type:"category",boundaryGap:!1,data:s},yAxis:{type:"value",axisPointer:{label:{formatter:function(o){return i.numberWithCommas(o.value.toFixed(0))}}}},series:[{name:"日活",type:"line",smooth:!0,data:a,lineStyle:{color:["#5470C6"][0]},label:{show:!0,position:"top",formatter:function(o){return i.numberWithCommas(o.value.toFixed(0))}}}]};d.setOption(l)}async function _(e){let{data:a,code:s}=await B.getUserChat({...e,channel_type:F.PRIVATE});if(i.isEqual(s,0)){let{items:t}=a;return{items:t}}return m.proxy.$toast({icon:"error",text:"日活统计失败，请刷新重试"}),{items:[]}}function v(e){return i.formatTime(new Date(e).getTime(),"yyyy-MM-dd")}async function x(e){i.map(n.buttons,o=>(o.isActive=i.isEqual(o.name,e.name),o));let{start:a,end:s}=y.getRangeDate(e.name),l=await _({app_key:u,start:a,end:s});p(l)}return b(()=>{let{start:e,end:a}=y.getRangeDate(8);_({app_key:u,start:e,end:a}).then(t=>{p(t)})}),k(()=>n.range,async()=>{let{start:e,end:a}=n.range;e=new Date(e).getTime(),a=new Date(a).getTime();let t=await _({app_key:u,start:e,end:a});p(t)}),(e,a)=>{const s=N("VDatePicker");return g(),f("div",I,[r("div",M,[r("div",O,[(g(!0),f(A,null,T(c(n).buttons,t=>(g(),f("div",{class:P(["cim-as-button",{"cim-as-button-active":t.isActive}]),onClick:l=>x(t)},h(t.title),11,U))),256)),r("div",$,[V(s,{modelValue:c(n).range,"onUpdate:modelValue":a[0]||(a[0]=t=>c(n).range=t),modelModifiers:{range:!0},class:"cim-as-date-picker"},{default:E(({togglePopover:t})=>[r("div",{class:"cim-as-date-content",onClick:t},h(v(c(n).range.start))+" 至 "+h(v(c(n).range.end)),9,q)]),_:1},8,["modelValue"])])])]),r("div",z,[r("div",G,null,512)])])}}};export{j as default};
