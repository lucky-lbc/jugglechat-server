import{L as w,M as b,f as n,p as P,r as D,z as G,o as h,B as V,w as W,b as t,q,v as N,u as c,d as F,_ as H,R as S,i as B,c as E,F as M,e as L,l as O,t as $}from"./index-0f2e41f6.js";import{c as K}from"./common-eab97762.js";import{_ as T}from"./avatar-04bd5dd2.js";import"./user-2c36cc99.js";function I(u={}){let{limit:_=200,page:f=1,app_key:r}=u,v=`${w.WORK_MANAGER_LIST}?app_key=${r}&count=${_}&page=${f}`;return b(v,{method:"GET"})}function J(u){return b(w.WORK_MANAGER_ADD,{method:"POST",body:n.toJSON(u)})}function z(u){return b(w.WORK_MANAGER_UPDATE,{method:"POST",body:n.toJSON(u)})}function j(u){return b(w.WORK_MANAGER_DELETE,{method:"POST",body:n.toJSON(u)})}const k={getList:I,add:J,update:z,remove:j},Q={class:"row g-2 cim-row cim-dialog-pull-row"},X={class:"form-floating cim-from-must cicon cicon-must"},Y={class:"form-floating cim-from-must cicon cicon-must"},Z={class:"cicon cim-form-add cim-upload form-control workinfo-avatar"},tt={class:"form-floating cim-from-must cicon cicon-must"},et={class:"form-floating cim-from-must cicon cicon-must"},ot={__name:"dialog-workapp-update",props:["title","text","show","item"],emits:["save","hide"],setup(u,{emit:_}){const f=B(),r=u,v=_;let a=P(),l=D({app_id:"",app_name:"",app_icon:"",app_url:"",app_order:1});function y(){let{app_id:p,app_name:i,app_icon:e,app_url:s,app_order:o}=l;if(n.isEqual(i.length,0))return f.proxy.$toast({icon:"error",text:"应用名称不可为空"});if(n.isEqual(e.length,0))return f.proxy.$toast({icon:"error",text:"应用图标不可为空"});if(n.isEqual(s.length,0))return f.proxy.$toast({icon:"error",text:"应用链接不可为空"});v("save",{app_id:p,app_name:i,app_icon:e,app_url:s,app_order:o})}function A(p){v("hide",{})}function C(p){p.target.parentElement.parentElement.children[0].click()}function R(p){const i=p.target.files[0];let{currentRoute:{_rawValue:{params:{app_key:e}}}}=a;K.uploadImage(e,i,(s,o)=>{if(!S.SUCCESS==s)return f.proxy.$toast({icon:"error",text:`Upload Error: ${s}`});l.app_icon=o})}return G(()=>r.show,p=>{p||n.extend(l,{app_name:"",app_url:"",app_icon:"",app_order:1}),p&&n.extend(l,{app_id:r.item.app_id||"",app_name:r.item.app_name||"",app_icon:r.item.app_icon||"",app_url:r.item.app_url||"",app_order:r.item.app_order||1})}),(p,i)=>(h(),V(H,{title:r.title,show:r.show,"btn-title":r.text,cls:"cim-pull-dialog",onHide:A,onSave:y},{default:W(()=>[t("div",Q,[t("div",X,[q(t("input",{class:"form-control",placeholder:"应用名称","onUpdate:modelValue":i[0]||(i[0]=e=>c(l).app_name=e)},null,512),[[N,c(l).app_name]]),i[3]||(i[3]=t("label",null,"应用名称",-1))]),t("div",Y,[t("input",{type:"file",style:{display:"none"},onChange:R},null,32),t("div",Z,[c(l).app_icon?(h(),V(T,{key:0,"user-id":c(l).app_id,name:c(l).app_name,avatar:c(l).app_icon,cls:"cim-small-avatar"},null,8,["user-id","name","avatar"])):F("",!0),t("div",{class:"cicon cim-form-add cim-upload",onClick:C},"上传图标")]),i[4]||(i[4]=t("label",null,"应用图标",-1))]),t("div",tt,[q(t("input",{class:"form-control",placeholder:"应用链接","onUpdate:modelValue":i[1]||(i[1]=e=>c(l).app_url=e)},null,512),[[N,c(l).app_url]]),i[5]||(i[5]=t("label",null,"应用链接",-1))]),t("div",et,[q(t("input",{class:"form-control",type:"number",placeholder:"应用排序","onUpdate:modelValue":i[2]||(i[2]=e=>c(l).app_order=e)},null,512),[[N,c(l).app_order]]),i[6]||(i[6]=t("label",null,"应用排序",-1))])])]),_:1},8,["title","show","btn-title"]))}},st={class:"mb-4 cim-log-contanier"},it={class:"cim-worklist-body"},at={class:"cim-worklist-preview-box"},lt={class:"preview-body"},nt={class:"iphone"},rt={class:"cim-ul-list"},ct={class:"cim-li-item"},pt={class:"cim-workinfo-item"},dt={class:"nickname"},ut={class:"cim-worklist-data-box"},mt={class:"table cim-table"},_t={class:"cim-td-c cim-workinfo"},ft={class:"cim-workinfo-item"},ht={class:"nickname"},vt={class:"cim-td-c"},gt=["href"],Et={class:"cim-td-c"},St={class:"cim-td-c"},xt={class:"cim-table-tools"},$t={class:"cim-table-tool"},kt=["onClick"],wt=["onClick"],Rt={__name:"worklist",setup(u){const _=B();let f=P(),{currentRoute:{_rawValue:{params:{app_key:r}}}}=f,v={offset:"",limit:50},a=D({isShowUpdate:!1,currentApp:{},params:n.clone(v),list:[]});function l(e){a.isShowUpdate=e,e||(a.currentApp={})}function y(e){let{app_id:s}=e;if(n.isEmpty(s)){k.add({app_key:r,...e}).then(o=>{let{code:d,msg:m,data:x}=o;n.isEqual(d,S.SUCCESS)?(l(!1),a.list.push(x),a.list=n.quickSort(a.list,(g,U)=>g.app_order<U.app_order)):_.proxy.$toast({icon:"error",text:`Error: ${d} ${m}`})});return}k.update({app_key:r,...e}).then(o=>{let{code:d,msg:m}=o;if(n.isEqual(d,S.SUCCESS)){l(!1);let x=n.find(a.list,g=>g.app_id==s);x>-1&&n.extend(a.list[x],e),a.list=n.quickSort(a.list,(g,U)=>g.app_order<U.app_order)}else _.proxy.$toast({icon:"error",text:`Error: ${d} ${m}`})})}function A(){l(!0)}function C(e){a.currentApp=e,l(!0)}function R(e){let s=a.list[e];k.remove({app_key:r,app_ids:[s.app_id]}).then(o=>{let{code:d,msg:m}=o;n.isEqual(d,S.SUCCESS)?a.list.splice(e,1):_.proxy.$toast({icon:"error",text:`Error: ${d} ${m}`})})}function p(){return n.isEmpty(a.currentApp)?"添加应用":"修改应用"}function i(){k.getList({app_key:r}).then(e=>{let{code:s,data:o,msg:d=""}=e;if(n.isEqual(s,S.SUCCESS)){let{items:m}=o;a.list=m}else _.proxy.$toast({icon:"error",text:`Error: ${s} ${d}`})})}return i(),(e,s)=>(h(),E("div",st,[t("div",{class:"cim-log-header"},[s[1]||(s[1]=t("ul",{class:"cim-log-header-lf-box"},null,-1)),t("ul",{class:"cim-log-header-rg-box"},[t("li",{class:"cim-log-lf-item"},[t("div",{class:"cim-button cim-button-bg",onClick:A},"添加应用")])])]),t("div",it,[t("div",at,[s[3]||(s[3]=t("div",{class:"header"},"预览页面",-1)),t("div",lt,[t("div",nt,[t("ul",rt,[(h(!0),E(M,null,L(c(a).list,o=>(h(),E("li",ct,[t("div",pt,[O(T,{"user-id":o.app_id,name:o.app_name,avatar:o.app_icon,cls:"cim-small-avatar"},null,8,["user-id","name","avatar"]),t("div",dt,$(o.app_name),1)]),s[2]||(s[2]=t("div",{class:"cicon cicon-right-arrow"},null,-1))]))),256))])])])]),t("div",ut,[t("table",mt,[s[4]||(s[4]=t("thead",null,[t("tr",null,[t("th",{class:"cim-td-c"},"应用信息"),t("th",{class:"cim-td-c"},"应用链接"),t("th",{class:"cim-td-c"},"应用排序"),t("th",{class:"cim-td-c"},"操作")])],-1)),t("tbody",null,[(h(!0),E(M,null,L(c(a).list,(o,d)=>(h(),E("tr",null,[t("td",_t,[t("div",ft,[O(T,{"user-id":o.app_id,name:o.app_name,avatar:o.app_icon,cls:"cim-small-avatar"},null,8,["user-id","name","avatar"]),t("div",ht,$(o.app_name),1)])]),t("td",vt,[t("a",{href:o.app_url,target:"_blank"},$(o.app_url),9,gt)]),t("td",Et,$(o.app_order),1),t("td",St,[t("ul",xt,[t("li",$t,[t("a",{class:"btn-link",href:"#",onClick:m=>C(o)},"修改",8,kt),t("a",{class:"btn-link",href:"#",onClick:m=>R(d)},"删除",8,wt)])])])]))),256))])])])]),O(ot,{show:c(a).isShowUpdate,item:c(a).currentApp,title:p(),text:"确定",onHide:s[0]||(s[0]=o=>l(!1)),onSave:y},null,8,["show","item","title"])]))}};export{Rt as default};
