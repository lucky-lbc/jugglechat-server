import{f as o,X as U,r as q,R as C,c as i,b as l,F as g,e as b,u as _,l as V,p as B,i as L,K as A,o as c,x as F,t as y,d as m}from"./index-0f2e41f6.js";import{R as $,_ as H}from"./dialog-3rd-5862f2a4.js";const P={class:"mb-4 app-base cim-r3-container cim-r3-container-sms"},z={class:"cim-r3-body"},I={class:"cim-r3-item"},K={class:"cim-r3-item-header"},M={class:"cim-r3-header-info"},O={class:"cim-r3-item-name"},T={class:"cim-r3-header-status"},X={key:0,class:"life-status"},Y={class:"cim-r3-item-contents"},j={class:"cim-rtc-item-content"},G={key:0,class:"title"},J={key:1,class:"value"},Q={key:2,class:"value unset"},W={class:"cim-r3-item-tools"},Z=["onClick"],ae={__name:"sms",setup(ee){let w=B(),{currentRoute:{_rawValue:{params:{app_key:E}}}}=w;const p=L();let x=o.clone(U),f={},r=q({list:[],current:x[0],isShowDialog:!1});function v(n,t){r.isShowDialog=n,n&&(r.current=t)}function D(n){let{uid:t,fields:a}=n,s={},e={};o.forEach(a,u=>{let{key:h,value:d}=u;e[h]=d}),s[t]=e,o.isEqual(A.ENABLE,e.is_used)&&(s.channel=t,o.forEach(r.list,u=>{u.isUsed=o.isEqual(u.uid,t)})),delete s[t].is_used,o.extend(f,s),N(f,s)}function N(n,t){$.setSms({app_key:E,conf:n}).then(a=>{let{code:s,data:e}=a;if(!o.isEqual(s,C.SUCCESS))return p.proxy.$toast({icon:"error",text:`添加失败: ${s}`});p.proxy.$toast({icon:"success",text:"操作成功"}),k(t),v(!1)})}$.getSms({app_key:E}).then(n=>{let{code:t,data:a}=n;if(!o.isEqual(t,C.SUCCESS))return p.proxy.$toast({icon:"error",text:`获取配置失败: ${t}`});f=o.clone(a),k(a,!0)});function k(n,t){let{channel:a}=n;o.forEach(x,s=>{let e=o.isEqual(s.uid,a),{uid:u,children:h}=s,d=n[u]||{};o.isEmpty(d)&&!t||(s.children=o.map(h,S=>{let{key:R}=S;return S.value=d[R]||"",S}),e&&(r.current=s),o.extend(s,{isUsed:e}),t&&r.list.push(s))})}return(n,t)=>(c(),i("div",P,[l("ul",z,[(c(!0),i(g,null,b(_(r).list,(a,s)=>(c(),i("li",I,[l("div",K,[l("div",M,[l("div",{class:F(["cim-r3-avatar",[a.icon+"-avatar"]])},null,2),l("div",O,y(a.name),1)]),l("div",T,[a.isUsed?(c(),i("span",X,"【已启用】")):m("",!0)])]),l("ul",Y,[(c(!0),i(g,null,b(a.children,e=>(c(),i("li",j,[e.type=="text"||e.type=="number"?(c(),i("div",G,y(e.name)+":",1)):m("",!0),(e.type=="text"||e.type=="number")&&e.value?(c(),i("div",J,y(e.secretValue||e.value),1)):m("",!0),(e.type=="text"||e.type=="number")&&!e.value?(c(),i("div",Q,"未设置")):m("",!0)]))),256))]),l("ul",W,[l("li",{class:"cim-r3-item-tool cicon wr-update",onClick:e=>v(!0,a)},"设置",8,Z)])]))),256))]),V(H,{show:_(r).isShowDialog,title:"短信设置",custom:"短信通道",channel:_(r).current,list:_(r).list,onSave:D,onHide:t[0]||(t[0]=a=>v(!1))},null,8,["show","channel","list"])]))}};export{ae as default};
