import{L as N,M as E,f as i,r as B,c as d,b as s,q as $,v as C,u,N as R,F as D,e as F,d as L,p as O,R as w,o as _,l as P,t as n,x as q,i as G}from"./index-0f2e41f6.js";import{_ as I}from"./avatar-04bd5dd2.js";import"./common-eab97762.js";import"./user-2c36cc99.js";function K(l={}){let{limit:m=50,offset:p,app_key:f,user_id:y,keywords:a}=l,k=`${N.USER_MANAGER_LIST}?app_key=${f}&user_id=${y}&name=${a}&count=${m}&offset=${p}`;return E(k,{method:"GET"})}function J(l){return E(N.USER_MANAGER_BAN,{method:"POST",body:i.toJSON(l)})}function z(l){return E(N.USER_MANAGER_UNBAN,{method:"POST",body:i.toJSON(l)})}const v={getList:K,ban:J,unban:z},H={class:"mb-4 cim-log-contanier"},j={class:"cim-log-header"},Q={class:"cim-log-header-lf-box"},W={class:"cim-log-lf-item"},X={class:"cim-log-lf-item"},Y={class:"cim-log-body"},Z={class:"table cim-table"},ss={class:"cim-td-c"},ts={class:"cim-userlist-info"},es={class:"nickname"},as={class:"cim-td-c"},os={class:"cim-td-c"},cs={class:"cim-td-c"},ns={class:"cim-td-c"},is={class:"cim-td-c"},ls={class:"cim-td-c display_layout"},rs={class:"cim-td-c"},ds={class:"cim-table-tools"},us={class:"cim-table-tool"},_s=["onClick"],ms=["onClick"],fs={class:"cim-log-footer"},hs={class:"cim-navigation"},ps={class:"pagination"},ys={class:"page-item"},Ns={__name:"userlist",setup(l){const m=G();let p=O(),{currentRoute:{_rawValue:{params:{app_key:f}}}}=p,y={offset:"",limit:50,app_key:f,user_id:"",keywords:""},a=B({params:i.clone(y),list:[],isFinished:!1});function k(o,e="yyyy-MM-dd"){return i.formatTime(new Date(o).getTime(),e)}function b(){g(!0)}function M(){a.params,g(!1)}function U(o){v.unban({app_key:f,items:[{user_id:o.user_id}]}).then(e=>{S(e,"已解封")}),o.status=0,o.statusName="正常"}function A(o){v.ban({app_key:f,items:[{user_id:o.user_id,end_time:0,end_time_offset:6e5}]}).then(e=>{S(e,"已封禁")}),o.status=1,o.statusName="已封禁"}function S(o,e){let{code:t,msg:r}=o;i.isEqual(t,w.SUCCESS)?m.proxy.$toast({icon:"success",text:e}):m.proxy.$toast({icon:"error",text:`Error: ${t} ${r}`})}function g(o){let e={...a.params};v.getList(e).then(t=>{let{code:r,data:T,msg:V=""}=t;if(i.isEqual(r,w.SUCCESS)){let{items:h,offset:x=""}=T;h=i.map(h,c=>(c.statusName=c.status==0?"正常":"已封禁",c.phone=c.phone||"-",c.account=c.account||"-",c.email=c.email||"-",c.time=k(c.created_time,"yyyy-MM-dd hh:mm:ss"),c)),o?a.list=h:(a.list=a.list.concat(h),a.params.offset=x),x==""&&!o&&(a.isFinished=!0)}else m.proxy.$toast({icon:"error",text:`Error: ${r} ${V}`})})}return g(!0),(o,e)=>(_(),d("div",H,[s("div",j,[s("ul",Q,[s("li",W,[$(s("input",{class:"form-control",type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>u(a).params.user_id=t),placeholder:"用户 ID",autocomplete:"off",onKeydown:R(b,["enter"])},null,544),[[C,u(a).params.user_id]])]),s("li",X,[$(s("input",{class:"form-control",type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>u(a).params.keywords=t),placeholder:"用户名称",autocomplete:"off",onKeydown:R(b,["enter"])},null,544),[[C,u(a).params.keywords]])]),s("li",{class:"cim-log-lf-item"},[s("div",{class:"cim-button cim-button-bg",onClick:b},"查询")])])]),s("div",Y,[s("table",Z,[e[2]||(e[2]=s("thead",null,[s("tr",null,[s("th",{class:"cim-td-c"},"用户昵称"),s("th",{class:"cim-td-c"},"用户 ID"),s("th",{class:"cim-td-c"},"注册时间"),s("th",{class:"cim-td-c"},"用户账号"),s("th",{class:"cim-td-c"},"手机号"),s("th",{class:"cim-td-c"},"邮箱"),s("th",{class:"cim-td-c"},"用户状态"),s("th",{class:"cim-td-c"},"操作")])],-1)),s("tbody",null,[(_(!0),d(D,null,F(u(a).list,t=>(_(),d("tr",null,[s("td",ss,[s("div",ts,[P(I,{"user-id":t.user_id,name:t.nickname,avatar:t.avatar,cls:"cim-small-avatar"},null,8,["user-id","name","avatar"]),s("div",es,n(t.nickname),1)])]),s("td",as,n(t.user_id),1),s("td",os,n(t.time),1),s("td",cs,n(t.account),1),s("td",ns,n(t.phone),1),s("td",is,n(t.email),1),s("td",ls,[s("span",{class:q(["cicon cim-log-status",["cicon-user-state-"+t.status]])},n(t.statusName),3)]),s("td",rs,[s("ul",ds,[s("li",us,[t.status==0?(_(),d("a",{key:0,class:"btn-link",href:"#",onClick:r=>A(t)},"封禁",8,_s)):(_(),d("a",{key:1,class:"btn-link",href:"#",onClick:r=>U(t)},"解禁",8,ms))])])])]))),256))])])]),s("div",fs,[s("nav",hs,[s("ul",ps,[s("li",ys,[u(a).isFinished?L("",!0):(_(),d("a",{key:0,class:"page-link",href:"#","aria-label":"Next",onClick:M},e[3]||(e[3]=[s("span",{"aria-hidden":"true"},"下一页",-1)])))])])])])]))}};export{Ns as default};
