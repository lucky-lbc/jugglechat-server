import{L as v,M as S,f as i,r as V,c as r,b as s,q as x,v as C,u as d,N as $,F as B,e as D,d as F,p as L,R,o as u,l as O,t as n,x as P,i as q}from"./index-611f2efb.js";import{_ as G}from"./avatar-8d37b2c3.js";import"./common-bf7d9f43.js";function I(l={}){let{limit:_=50,offset:f,app_key:m}=l,p=`${v.USER_MANAGER_LIST}?app_key=${m}&count=${_}&offset=${f}`;return S(p,{method:"GET"})}function K(l){return S(v.USER_MANAGER_BAN,{method:"POST",body:i.toJSON(l)})}function J(l){return S(v.USER_MANAGER_UNBAN,{method:"POST",body:i.toJSON(l)})}const g={getList:I,ban:K,unban:J},z={class:"mb-4 cim-log-contanier"},H={class:"cim-log-header"},j={class:"cim-log-header-lf-box"},Q={class:"cim-log-lf-item"},W={class:"cim-log-lf-item"},X={class:"cim-log-body"},Y={class:"table cim-table"},Z={class:"cim-td-c"},ss={class:"cim-userlist-info"},ts={class:"nickname"},es={class:"cim-td-c"},as={class:"cim-td-c"},os={class:"cim-td-c"},cs={class:"cim-td-c"},ns={class:"cim-td-c"},is={class:"cim-td-c display_layout"},ls={class:"cim-td-c"},rs={class:"cim-table-tools"},ds={class:"cim-table-tool"},us=["onClick"],_s=["onClick"],ms={class:"cim-log-footer"},hs={class:"cim-navigation"},fs={class:"pagination"},ps={class:"page-item"},gs={__name:"userlist",setup(l){const _=q();let f=L(),{currentRoute:{_rawValue:{params:{app_key:m}}}}=f,p={offset:"",limit:50,app_key:m,user_id:"",keywords:""},a=V({params:i.clone(p),list:[],isFinished:!1});function M(c,e="yyyy-MM-dd"){return i.formatTime(new Date(c).getTime(),e)}function y(){k()}function U(){a.params,k()}function w(c){g.unban({app_key:m,items:[{user_id:c.user_id}]}).then(e=>{E(e,"已解封")})}function A(c){g.ban({app_key:m,items:[{user_id:c.user_id,end_time:0,end_time_offset:6e5}]}).then(e=>{E(e,"已封禁")})}function E(c,e){let{code:t,msg:h}=c;i.isEqual(t,R.SUCCESS)?_.proxy.$toast({icon:"success",text:e}):_.proxy.$toast({icon:"error",text:`Error: ${t} ${h}`})}function k(){let c={...a.params};g.getList(c).then(e=>{let{code:t,data:h,msg:T=""}=e;if(i.isEqual(t,R.SUCCESS)){let{items:b,offset:N=""}=h;b=i.map(b,o=>(o.statusName=o.status==0?"正常":"已封禁",o.phone=o.phone||"-",o.account=o.account||"-",o.email=o.email||"-",o.time=M(o.created_time,"yyyy-MM-dd hh:mm:ss"),o)),a.list=a.list.concat(b),N==""&&(a.isFinished=!0),a.params.offset=N}else _.proxy.$toast({icon:"error",text:`Error: ${t} ${T}`})})}return k(),(c,e)=>(u(),r("div",z,[s("div",H,[s("ul",j,[s("li",Q,[x(s("input",{class:"form-control",type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>d(a).params.user_id=t),placeholder:"用户 ID",autocomplete:"off",onKeydown:$(y,["enter"])},null,544),[[C,d(a).params.user_id]])]),s("li",W,[x(s("input",{class:"form-control",type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>d(a).params.keywords=t),placeholder:"用户名称",autocomplete:"off",onKeydown:$(y,["enter"])},null,544),[[C,d(a).params.keywords]])]),s("li",{class:"cim-log-lf-item"},[s("div",{class:"cim-button cim-button-bg",onClick:y},"查询")])])]),s("div",X,[s("table",Y,[e[2]||(e[2]=s("thead",null,[s("tr",null,[s("th",{class:"cim-td-c"},"用户昵称"),s("th",{class:"cim-td-c"},"用户 ID"),s("th",{class:"cim-td-c"},"注册时间"),s("th",{class:"cim-td-c"},"用户账号"),s("th",{class:"cim-td-c"},"手机号"),s("th",{class:"cim-td-c"},"邮箱"),s("th",{class:"cim-td-c"},"用户状态"),s("th",{class:"cim-td-c"},"操作")])],-1)),s("tbody",null,[(u(!0),r(B,null,D(d(a).list,t=>(u(),r("tr",null,[s("td",Z,[s("div",ss,[O(G,{"user-id":t.user_id,name:t.nickname,avatar:t.avatar,cls:"cim-small-avatar"},null,8,["user-id","name","avatar"]),s("div",ts,n(t.nickname),1)])]),s("td",es,n(t.user_id),1),s("td",as,n(t.time),1),s("td",os,n(t.account),1),s("td",cs,n(t.phone),1),s("td",ns,n(t.email),1),s("td",is,[s("span",{class:P(["cicon cim-log-status",["cicon-user-state-"+t.status]])},n(t.statusName),3)]),s("td",ls,[s("ul",rs,[s("li",ds,[t.status==0?(u(),r("a",{key:0,class:"btn-link",href:"#",onClick:h=>A(t)},"封禁",8,us)):(u(),r("a",{key:1,class:"btn-link",href:"#",onClick:h=>w(t)},"解禁",8,_s))])])])]))),256))])])]),s("div",ms,[s("nav",hs,[s("ul",fs,[s("li",ps,[d(a).isFinished?F("",!0):(u(),r("a",{key:0,class:"page-link",href:"#","aria-label":"Next",onClick:U},e[3]||(e[3]=[s("span",{"aria-hidden":"true"},"下一页",-1)])))])])])])]))}};export{gs as default};
