import{r as D,z as q,o as c,B as V,w as N,b as s,c as p,e as y,t as r,u as i,F as g,_ as R,f as a,i as T,A as I,ag as H,ah as m,l as P,U as O,j as $,x as z,q as k,v as C,d as M,C as F}from"./index-611f2efb.js";import{U as _}from"./user-7d6fcff1.js";const X={class:"cim-dialog-bind-app"},j={class:"cim-dialog-bind-box left"},Y={class:"bind-apps"},G={class:"bind-app"},J={class:"bind-app-info"},K={class:"bind-app-name"},Q={class:"bind-app-appkey"},W={class:"tools"},Z={class:"tool"},tt=["onClick"],st={class:"cim-dialog-bind-box right"},et={class:"bind-apps"},nt={class:"bind-app"},ot={class:"bind-app-info"},it={class:"bind-app-name"},at={class:"bind-app-appkey"},lt={class:"tools"},dt={class:"tool"},rt=["onClick"],ct={__name:"dialog-bind-app",props:["title","text","account","show"],emits:["save","hide"],setup(U,{emit:f}){const h=T(),n=U,b=f;let l=D({appList:[],bandAppList:[],removeBindList:[]});async function L(){l.removeBindList.length>0&&await _.unBindApp({account:n.account,app_keys:l.removeBindList.map(o=>o.app_key)}),_.bindApp({account:n.account,app_keys:l.bandAppList.map(o=>o.app_key)}).then(o=>{h.proxy.$toast({icon:"success",text:"绑定成功"}),b("save",{})})}function S(o){b("hide",{})}function A(o,t){l.bandAppList.push(o),l.appList.splice(t,1)}function w(o,t){l.appList.push(o),l.bandAppList.splice(t,1),o.isBind&&l.removeBindList.push(o)}async function x(){let t=(await I.getList()).data.items||[],d=(await I.getList({account:n.account})).data.items||[];d=d.map(u=>({...u,isBind:!0})),l.appList=a.filter(t,u=>a.find(d,v=>v.app_key==u.app_key)==-1),l.bandAppList=d}return q(()=>n.show,o=>{o?x():a.extend(l,{appList:[],bandAppList:[],removeBindList:[]})}),(o,t)=>(c(),V(R,{title:n.title,show:n.show,"btn-title":n.text,onHide:S,onSave:L,cls:"cim-dialog-bind-modal"},{default:N(()=>[s("div",X,[s("div",j,[t[0]||(t[0]=s("div",{class:"bind-header"},"应用列表",-1)),s("ul",Y,[(c(!0),p(g,null,y(i(l).appList,(e,d)=>(c(),p("li",G,[s("div",J,[s("div",K,r(e.app_name),1),s("div",Q,r(e.app_key),1)]),s("div",W,[s("div",Z,[s("span",{class:"cicon cicon-add",onClick:u=>A(e,d)},null,8,tt)])])]))),256))])]),s("div",st,[t[1]||(t[1]=s("div",{class:"bind-header"},"已绑定列表",-1)),s("ul",et,[(c(!0),p(g,null,y(i(l).bandAppList,(e,d)=>(c(),p("li",nt,[s("div",ot,[s("div",it,r(e.app_name),1),s("div",at,r(e.app_key),1)]),s("div",lt,[s("div",dt,[s("span",{class:"cicon cicon-close",onClick:u=>w(e,d)},null,8,rt)])])]))),256))])])])]),_:1},8,["title","show","btn-title"]))}},pt={class:"mb-4"},ut={class:"header cim-header"},mt={class:"table cim-table"},ft={class:"cim-td-c cim-td-operate"},vt=["onClick"],_t=["onClick"],bt=["onClick"],Et={class:"row g-2 cim-row"},wt={class:"form-floating"},ht=["disabled"],$t={key:0,class:"invalid-feedback feedback"},kt={class:"form-floating"},yt={key:0,class:"invalid-feedback feedback"},gt={class:"form-floating"},Lt={key:0,class:"invalid-feedback feedback"},St={class:"form-floating"},At=["value"],Ct={__name:"manager",setup(U){let f=T(),h={account:"",password:"",confirmPasswrod:"",state:m.ENABLE,role:O.ADMIN},n=D({users:[],roles:a.clone(H),radios:[{name:"type",value:m.ENABLE,label:"启用"},{name:"type",value:m.DISABLE,label:"禁用"}],isShowEdit:!1,user:a.clone(h),accountErrorMsg:"",pwdErrorMsg:"",conPwdErrorMsg:"",isShowBindApp:!1,selectUser:{}});_.getUsers().then(({data:o})=>{let{items:t}=o;n.users=t.map(e=>(e.time=a.formatTime(e.created_time),e))});function b(o,t){n.isShowEdit=o,t&&(n.user=t),o||(n.user=a.clone(h))}function l(o,t){n.isShowBindApp=o,n.selectUser=o?t:{}}function L(o){let t;a.isEqual(o.state,m.ENABLE)&&(t=m.DISABLE),a.isEqual(o.state,m.DISABLE)&&(t=m.ENABLE),_.disable({accounts:[o.account],is_disable:t}).then(()=>{n.users.map(e=>(a.isEqual(o.account,e.account)&&a.extend(e,{state:t}),e)),f.proxy.$toast({icon:"success",text:"操作成功",duration:4e3})})}function S(o){let t=n.users[o];_.remove({accounts:[t.account]}).then(()=>{n.users.splice(o,1),f.proxy.$toast({icon:"success",text:"删除成功",duration:4e3})})}function A(){let{user:o}=n,{account:t,password:e,confirmPasswrod:d,role:u}=o;if(a.isEmpty(t))return n.accountErrorMsg="账户名称不能为空";if(a.isEmpty(e))return n.pwdErrorMsg="密码不能为空";if(!a.isEqual(d,e))return n.conPwdErrorMsg="两次密码输入不一致";if(o.created_time)return _.updatePwd({account:t,password:e,new_password:d,role_type:u}).then(({code:E,msg:v})=>{a.isEqual(E,$.SUCCESS_0.code)?f.proxy.$toast({icon:"success",text:"修改密码成功",duration:3e3}):f.proxy.$toast({icon:"error",text:`${E}:${v}`,duration:3e3})});_.add({account:t,password:e,state:o.state,role_type:u}).then(({code:E})=>{let v="success",B="保存成功";a.isEqual(E,$.SUCCESS_0.code)?(o.time=a.formatTime(Date.now()),n.users.push(o),b(!1)):a.isEqual(E,$.USER_EXISTS.code)?(v="error",B=$.USER_EXISTS.msg):(v="error",B="保存失败，请重试"),f.proxy.$toast({icon:v,text:B,duration:4e3})})}function w(o){({account:()=>{n.accountErrorMsg=""},pwd:()=>{n.pwdErrorMsg=""},confirm:()=>{n.conPwdErrorMsg=""}})[o]()}function x(){l(!1,{})}return(o,t)=>(c(),p("div",pt,[s("div",ut,[t[12]||(t[12]=s("div",{class:"cim-title"},"用户管理",-1)),s("div",{class:"cicon cicon-add cim-button cim-button-bg",onClick:t[0]||(t[0]=e=>b(!0))},"添加用户")]),s("table",mt,[t[14]||(t[14]=s("thead",null,[s("tr",null,[s("th",null,"用户名称"),s("th",null,"用户账号"),s("th",null,"用户密码"),s("th",null,"是否启用"),s("th",null,"创建时间"),s("th",{class:"cim-td-c"},"操作")])],-1)),s("tbody",null,[(c(!0),p(g,null,y(i(n).users,(e,d)=>(c(),p("tr",null,[s("td",null,r(e.account),1),s("td",null,r(e.account),1),t[13]||(t[13]=s("td",null,"**** ****",-1)),s("td",{class:z(["cicon",{"cicon-success":e.state==i(m).ENABLE,"cicon-error":e.state==i(m).DISABLE}])},r(e.state==i(m).ENABLE?"已启用":"已禁用"),3),s("td",null,r(e.time),1),s("td",ft,[s("a",{class:"btn-link cim-btn-link",type:"button",onClick:u=>l(!0,e)},"绑定应用",8,vt),s("a",{class:"btn-link cim-btn-link",type:"button",onClick:u=>L(e)},r(e.state==i(m).DISABLE?"启用":"禁用"),9,_t),s("a",{class:"btn-link cim-btn-link",type:"button",onClick:u=>S(d)},"删除",8,bt)])]))),256))])]),P(R,{show:i(n).isShowEdit,title:"添加用户",onHide:t[8]||(t[8]=e=>b(!1)),onSave:t[9]||(t[9]=e=>A())},{default:N(()=>[s("div",Et,[s("div",wt,[k(s("input",{class:"form-control",disabled:i(n).user.created_time,"onUpdate:modelValue":t[1]||(t[1]=e=>i(n).user.account=e),type:"text",placeholder:"用户名称",autocomplete:"off",onInput:t[2]||(t[2]=e=>w("account"))},null,40,ht),[[C,i(n).user.account]]),t[15]||(t[15]=s("label",null,"用户名称",-1)),i(n).accountErrorMsg?(c(),p("div",$t,r(i(n).accountErrorMsg),1)):M("",!0)]),s("div",kt,[k(s("input",{class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>i(n).user.password=e),type:"text",placeholder:"用户密码",onInput:t[4]||(t[4]=e=>w("pwd"))},null,544),[[C,i(n).user.password]]),t[16]||(t[16]=s("label",null,"用户密码",-1)),i(n).pwdErrorMsg?(c(),p("div",yt,r(i(n).pwdErrorMsg),1)):M("",!0)]),s("div",gt,[k(s("input",{class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>i(n).user.confirmPasswrod=e),type:"text",placeholder:"确认密码",onInput:t[6]||(t[6]=e=>w("confirm"))},null,544),[[C,i(n).user.confirmPasswrod]]),t[17]||(t[17]=s("label",null,"确认密码",-1)),i(n).conPwdErrorMsg?(c(),p("div",Lt,r(i(n).conPwdErrorMsg),1)):M("",!0)]),s("div",St,[k(s("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=e=>i(n).user.role=e)},[(c(!0),p(g,null,y(i(n).roles,e=>(c(),p("option",{value:e.value},r(e.name),9,At))),256))],512),[[F,i(n).user.role]]),t[18]||(t[18]=s("label",null,"用户角色",-1))]),t[19]||(t[19]=s("input",{type:"password",autocomplete:"new-password",style:{display:"none"}},null,-1))])]),_:1},8,["show"]),P(ct,{show:i(n).isShowBindApp,title:"绑定应用",account:i(n).selectUser.account,onHide:t[10]||(t[10]=e=>l(!1)),onSave:t[11]||(t[11]=e=>x())},null,8,["show","account"])]))}};export{Ct as default};
