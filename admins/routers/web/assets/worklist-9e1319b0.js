import{L as C,M as R,f as i,r as L,z as D,o as g,B,w as G,b as t,q as $,v as w,u as c,_ as W,i as P,c as E,F as T,e as M,l as N,p as H,R as k,t as y}from"./index-611f2efb.js";import{_ as V}from"./avatar-8d37b2c3.js";import"./common-bf7d9f43.js";function K(d={}){let{limit:m=200,page:f=1,app_key:a}=d,v=`${C.WORK_MANAGER_LIST}?app_key=${a}&count=${m}&page=${f}`;return R(v,{method:"GET"})}function J(d){return R(C.WORK_MANAGER_ADD,{method:"POST",body:i.toJSON(d)})}function F(d){return R(C.WORK_MANAGER_UPDATE,{method:"POST",body:i.toJSON(d)})}function I(d){return R(C.WORK_MANAGER_DELETE,{method:"POST",body:i.toJSON(d)})}const A={getList:K,add:J,update:F,remove:I},z={class:"row g-2 cim-row cim-dialog-pull-row"},j={class:"form-floating cim-from-must cicon cicon-must"},Q={class:"form-floating cim-from-must cicon cicon-must"},X={class:"form-floating cim-from-must cicon cicon-must"},Y={class:"form-floating cim-from-must cicon cicon-must"},Z={__name:"dialog-workapp-update",props:["title","text","show","item"],emits:["save","hide"],setup(d,{emit:m}){const f=P(),a=d,v=m;let e=L({app_id:"",app_name:"",app_icon:"",app_url:"",app_order:1});function h(){let{app_id:_,app_name:s,app_icon:r,app_url:S,app_order:q}=e;if(i.isEqual(s.length,0))return f.proxy.$toast({icon:"error",text:"应用名称不可为空"});if(i.isEqual(r.length,0))return f.proxy.$toast({icon:"error",text:"应用图标不可为空"});if(i.isEqual(S.length,0))return f.proxy.$toast({icon:"error",text:"应用链接不可为空"});v("save",{app_id:_,app_name:s,app_icon:r,app_url:S,app_order:q})}function U(_){v("hide",{})}return D(()=>a.show,_=>{_||i.extend(e,{app_name:"",app_url:"",app_icon:"",app_order:1}),_&&i.extend(e,{app_id:a.item.app_id||"",app_name:a.item.app_name||"",app_icon:a.item.app_icon||"",app_url:a.item.app_url||"",app_order:a.item.app_order||1})}),(_,s)=>(g(),B(W,{title:a.title,show:a.show,"btn-title":a.text,cls:"cim-pull-dialog",onHide:U,onSave:h},{default:G(()=>[t("div",z,[t("div",j,[$(t("input",{class:"form-control",placeholder:"应用名称","onUpdate:modelValue":s[0]||(s[0]=r=>c(e).app_name=r)},null,512),[[w,c(e).app_name]]),s[4]||(s[4]=t("label",null,"应用名称",-1))]),t("div",Q,[$(t("input",{class:"form-control",placeholder:"应用图标","onUpdate:modelValue":s[1]||(s[1]=r=>c(e).app_icon=r)},null,512),[[w,c(e).app_icon]]),s[5]||(s[5]=t("label",null,"应用图标",-1))]),t("div",X,[$(t("input",{class:"form-control",placeholder:"应用链接","onUpdate:modelValue":s[2]||(s[2]=r=>c(e).app_url=r)},null,512),[[w,c(e).app_url]]),s[6]||(s[6]=t("label",null,"应用链接",-1))]),t("div",Y,[$(t("input",{class:"form-control",type:"number",placeholder:"应用排序","onUpdate:modelValue":s[3]||(s[3]=r=>c(e).app_order=r)},null,512),[[w,c(e).app_order]]),s[7]||(s[7]=t("label",null,"应用排序",-1))])])]),_:1},8,["title","show","btn-title"]))}},tt={class:"mb-4 cim-log-contanier"},et={class:"cim-worklist-body"},ot={class:"cim-worklist-preview-box"},st={class:"preview-body"},it={class:"iphone"},lt={class:"cim-ul-list"},at={class:"cim-li-item"},nt={class:"cim-workinfo-item"},rt={class:"nickname"},pt={class:"cim-worklist-data-box"},ct={class:"table cim-table"},dt={class:"cim-td-c cim-workinfo"},ut={class:"cim-workinfo-item"},mt={class:"nickname"},_t={class:"cim-td-c"},ft=["href"],ht={class:"cim-td-c"},vt={class:"cim-td-c"},gt={class:"cim-table-tools"},xt={class:"cim-table-tool"},Et=["onClick"],St=["onClick"],kt={__name:"worklist",setup(d){const m=P();let f=H(),{currentRoute:{_rawValue:{params:{app_key:a}}}}=f,v={offset:"",limit:50},e=L({isShowUpdate:!1,currentApp:{},params:i.clone(v),list:[]});function h(n){e.isShowUpdate=n,n||(e.currentApp={})}function U(n){let{app_id:l}=n;if(i.isEmpty(l)){A.add({app_key:a,...n}).then(o=>{let{code:p,msg:u,data:b}=o;i.isEqual(p,k.SUCCESS)?(h(!1),e.list.push(b),e.list=i.quickSort(e.list,(x,O)=>x.app_order<O.app_order)):m.proxy.$toast({icon:"error",text:`Error: ${p} ${u}`})});return}A.update({app_key:a,...n}).then(o=>{let{code:p,msg:u}=o;if(i.isEqual(p,k.SUCCESS)){h(!1);let b=i.find(e.list,x=>x.app_id==l);b>-1&&i.extend(e.list[b],n),e.list=i.quickSort(e.list,(x,O)=>x.app_order<O.app_order)}else m.proxy.$toast({icon:"error",text:`Error: ${p} ${u}`})})}function _(){h(!0)}function s(n){e.currentApp=n,h(!0)}function r(n){let l=e.list[n];A.remove({app_key:a,app_ids:[l.app_id]}).then(o=>{let{code:p,msg:u}=o;i.isEqual(p,k.SUCCESS)?e.list.splice(n,1):m.proxy.$toast({icon:"error",text:`Error: ${p} ${u}`})})}function S(){return i.isEmpty(e.currentApp)?"添加应用":"修改应用"}function q(){A.getList({app_key:a}).then(n=>{let{code:l,data:o,msg:p=""}=n;if(i.isEqual(l,k.SUCCESS)){let{items:u}=o;e.list=u}else m.proxy.$toast({icon:"error",text:`Error: ${l} ${p}`})})}return q(),(n,l)=>(g(),E("div",tt,[t("div",{class:"cim-log-header"},[l[1]||(l[1]=t("ul",{class:"cim-log-header-lf-box"},null,-1)),t("ul",{class:"cim-log-header-rg-box"},[t("li",{class:"cim-log-lf-item"},[t("div",{class:"cim-button cim-button-bg",onClick:_},"添加应用")])])]),t("div",et,[t("div",ot,[l[3]||(l[3]=t("div",{class:"header"},"预览页面",-1)),t("div",st,[t("div",it,[t("ul",lt,[(g(!0),E(T,null,M(c(e).list,o=>(g(),E("li",at,[t("div",nt,[N(V,{"user-id":o.app_id,name:o.app_name,avatar:o.app_icon,cls:"cim-small-avatar"},null,8,["user-id","name","avatar"]),t("div",rt,y(o.app_name),1)]),l[2]||(l[2]=t("div",{class:"cicon cicon-right-arrow"},null,-1))]))),256))])])])]),t("div",pt,[t("table",ct,[l[4]||(l[4]=t("thead",null,[t("tr",null,[t("th",{class:"cim-td-c"},"应用信息"),t("th",{class:"cim-td-c"},"应用链接"),t("th",{class:"cim-td-c"},"应用排序"),t("th",{class:"cim-td-c"},"操作")])],-1)),t("tbody",null,[(g(!0),E(T,null,M(c(e).list,(o,p)=>(g(),E("tr",null,[t("td",dt,[t("div",ut,[N(V,{"user-id":o.app_id,name:o.app_name,avatar:o.app_icon,cls:"cim-small-avatar"},null,8,["user-id","name","avatar"]),t("div",mt,y(o.app_name),1)])]),t("td",_t,[t("a",{href:o.app_url,target:"_blank"},y(o.app_url),9,ft)]),t("td",ht,y(o.app_order),1),t("td",vt,[t("ul",gt,[t("li",xt,[t("a",{class:"btn-link",href:"#",onClick:u=>s(o)},"修改",8,Et),t("a",{class:"btn-link",href:"#",onClick:u=>r(p)},"删除",8,St)])])])]))),256))])])])]),N(Z,{show:c(e).isShowUpdate,item:c(e).currentApp,title:S(),text:"确定",onHide:l[0]||(l[0]=o=>h(!1)),onSave:U},null,8,["show","item","title"])]))}};export{kt as default};
