import{r as C,ad as D,n as b,z as k,c as f,b as r,F as A,e as T,u as c,l as V,w as E,p as R,H as N,o as g,x as P,t as h,ae as F,f as i,i as S}from"./index-ea81747c.js";import{c as y}from"./common-a08d12d5.js";import{A as B}from"./analysis-5a3b484d.js";import"./user-1c0de017.js";const I={class:"mb-4 cim-as-box"},M={class:"cim-as-tools"},O={class:"cim-as-tool"},U=["onClick"],$={class:"cim-as-date cicon cicon-date"},q=["onClick"],z={class:"row cim-as-body"},G={class:"cim-bk-form",ref:"asuserchat"},J={__name:"user",setup(W){const m=S();let w=R(),{currentRoute:{_rawValue:{params:{app_key:u}}}}=w,n=C({buttons:D,range:{start:new Date(Date.now()-8*24*60*60*1e3),end:new Date(Date.now()-1*24*60*60*1e3)}}),d=null;function p(t){if(!d){let{asuserchat:o}=m.refs;d=m.proxy.$echat.init(o)}let{daus:a,dates:s}=y.formatDauChat(t),l={legend:{data:["日活"]},tooltip:{trigger:"none",axisPointer:{type:"cross"}},xAxis:{type:"category",boundaryGap:!1,data:s},yAxis:{type:"value",axisPointer:{label:{formatter:function(o){return i.numberWithCommas(o.value.toFixed(0))}}}},series:[{name:"日活",type:"line",smooth:!0,data:a,lineStyle:{color:["#5470C6"][0]},label:{show:!0,position:"top",formatter:function(o){return i.numberWithCommas(o.value.toFixed(0))}}}]};d.setOption(l)}async function _(t){let{data:a,code:s}=await B.getUserChat({...t,channel_type:F.PRIVATE});if(i.isEqual(s,0)){let{items:e}=a;return{items:e}}return m.proxy.$toast({icon:"error",text:"日活统计失败，请刷新重试"}),{items:[]}}function v(t){return i.formatTime(new Date(t).getTime(),"yyyy-MM-dd")}async function x(t){i.map(n.buttons,o=>(o.isActive=i.isEqual(o.name,t.name),o));let{start:a,end:s}=y.getRangeDate(t.name),l=await _({app_key:u,start:a,end:s});p(l)}return b(()=>{let{start:t,end:a}=y.getRangeDate(8);_({app_key:u,start:t,end:a}).then(e=>{p(e)})}),k(()=>n.range,async()=>{let{start:t,end:a}=n.range;t=new Date(t).getTime(),a=new Date(a).getTime();let e=await _({app_key:u,start:t,end:a});p(e)}),(t,a)=>{const s=N("VDatePicker");return g(),f("div",I,[r("div",M,[r("div",O,[(g(!0),f(A,null,T(c(n).buttons,e=>(g(),f("div",{class:P(["cim-as-button",{"cim-as-button-active":e.isActive}]),onClick:l=>x(e)},h(e.title),11,U))),256)),r("div",$,[V(s,{modelValue:c(n).range,"onUpdate:modelValue":a[0]||(a[0]=e=>c(n).range=e),modelModifiers:{range:!0},class:"cim-as-date-picker"},{default:E(({togglePopover:e})=>[r("div",{class:"cim-as-date-content",onClick:e},h(v(c(n).range.start))+" 至 "+h(v(c(n).range.end)),9,q)]),_:1},8,["modelValue"])])])]),r("div",z,[r("div",G,null,512)])])}}};export{J as default};
